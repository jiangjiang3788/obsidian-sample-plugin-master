根据你提供的完整代码和已有重构进展，我已经给出一套完整的分层与解耦方案，针对 `src/features/views` 与 `src/core` 的职责划分如下，并结合你当前目录和实现做了具体落地设计：

1. 总体架构目标
- `features/views/*View.tsx`：仅负责视图模式切换、布局（行列、折叠、响应式）、调用 core 纯函数和 shared UI 组件，不再写复杂业务逻辑。
- `core`：承载所有与业务相关的“工具逻辑”，包括视图配置、数据聚合、rating 映射、时间范围计算等纯函数。
- `shared/ui`：承载可复用 UI 组件，如 Task 行、字段 pill、heatmap 单元格、统计图块等，只依赖 schema 类型和简单 util。

2. 已完成的解耦
- Heatmap 视图：
  - `src/core/config/heatmapViewConfig.ts`：Heatmap 默认配置与 `isImagePath` / `isHexColor` 工具。
  - `src/core/utils/heatmapTemplate.ts`：从 InputSettings/BlockTemplate/ThemeOverride 计算有效模板 + rating 映射，封装在 `RatingMappingCache`。
  - `src/core/utils/heatmapAggregation.ts`：按 themePath+date 聚合为 `Map<string, Map<string, Item[]>>`，构建 `themesByPath` 映射和按 theme 收集 items。
  - `src/shared/ui/heatmap/HeatmapCell.tsx`：封装 Heatmap 的单元格 UI 和业务逻辑（打卡次数、等级次数、visualValue、tooltip 文案等）。
  - `src/features/views/HeatmapView.tsx`：已瘦身为仅进行：
    - config 合并（`DEFAULT_CONFIG + module.viewConfig`）
    - 主题行循环、折叠状态、布局（行布局/网格布局）
    - 调用 core 聚合函数与 `HeatmapCell`，不再内联 rating 解析/数据聚合/tooltip 文案。

- Block / Table 视图：
  - `src/shared/ui/items/FieldPill.tsx`：通用字段 pill 渲染（tags/categoryKey/pintu/普通字段），替代 BlockView 的内联 FieldRenderer。
  - `src/shared/ui/items/TaskRow.tsx`：统一任务行渲染（TaskCheckbox + 链接 + Timer 按钮 + 可选字段），用于 BlockView/TableView，两者不再重复写任务渲染。
  - `src/shared/ui/items/ItemLink.tsx`：封装 `makeObsUri(item, app)`，统一 Item 链接行为。
  - `BlockView.tsx`：改为依赖 FieldPill/TaskRow/ItemLink，仅负责：
    - 是否窄屏（ResizeObserver 控制 isNarrow）
    - 分组与折叠（用 `groupItemsByField` / `getSortedGroupKeys` + `collapsedGroups`）
    - 渲染 Task 用 TaskRow，渲染 Block 用 BlockItem（内部组合 FieldPill+ItemLink）。
  - `TableView.tsx`：改为用 TaskRow/ItemLink 渲染每个 cell item，仅保留：
    - `buildTableMatrix` 得到 matrix/sortedRows/sortedCols
    - 表格结构本身。

- 统计视图准备：
  - `src/core/utils/statisticsAggregation.ts`：封装 Statistics 的 period 聚合逻辑，包括：
    - 基于 DateRange / period 字段的 day/week/month/quarter/year 聚合。
    - 使用 `getBaseCategory(item.categoryKey)` 且只统计配置 categories 中的分类。
  - `src/shared/ui/statistics/ChartBlock.tsx`：从原 StatisticsView 提取出的通用图块组件，内部包含：
    - 智能 height 算法：支持 smart/linear/logarithmic，根据数据分布自动调整柱状高度，并保证最小可见高度。
    - 统一结构（上数字、中柱状、下类别），单击整个块或单个分类柱时触发对应 onCellClick 回调。

3. 针对各视图的后续解耦方案（已经详细设计）
- StatisticsView：
  - 删除内部内联的 ChartBlock，改为导入 `@shared/ui/statistics/ChartBlock`。
  - 顶层构造 CategoryConfig 数组（name/color/alias），统一传给 core 聚合和 ChartBlock。
  - 各视图模式调用 core 聚合：
    - 天视图：`aggregateByDay(items, selectedDate, categoryConfigs, usePeriod)`
    - 周视图：`aggregateByWeek(items, weekStart, weekEnd, categoryConfigs, usePeriod)`
    - 月视图：`aggregateByMonth(...)` + `getMonthWeeksData(...)`
    - 季视图：`aggregateByQuarter(...)` + 对应月份和周的 `aggregateByMonth` / `getMonthWeeksData`
    - 年视图：`aggregateByYear(...)`，返回 year/quarters/months/weeks 的 PeriodData 列表。
  - Popover 暂时保留在 StatisticsView 内，只负责 UI 和 BlockView 渲染，后续可抽到 `shared/ui/statistics/StatisticsPopover.tsx` 进一步复用。

- TimelineView：
  - 在 `src/core/utils/timelineAggregation.ts` 中集中 timeline 相关业务逻辑：
    - 将 `mapTaskToCategory` 和目前年/季模式 summary useMemo 中的聚合逻辑，封装为：
      - `buildMonthlyAndWeeklySummary(timelineTasks, config)`：生成 `TimelineSummaryTable` 所需的 summaryData。
      - `buildSummaryCategoryHours(timelineTasks, dateRange, config)`：计算当前视图汇总条 `summaryCategoryHours`。
      - `buildDailyCategoryHours(blocks, categoriesConfig, untrackedLabel)`：提供给每日头部进度条 `DayColumnHeader`。
  - 在 `src/shared/ui/timeline` 下拆出 UI：
    - `ProgressBlock.tsx`：从 TimelineView 中抽离现有实现，用于日/周/月/年 summary 的时间分布条。
    - `TimelineSummaryTable.tsx`：渲染 summaryData 表格（月份 + 月度 summary + 每周 summary）。
    - `DayColumnHeader.tsx`：按日显示头部标题 + ProgressBlock。
    - `DayColumnBody.tsx`（可选拆）：渲染纵向时间轴和 TaskBlock，支持传入 `onEditTask`/`onAlignPrev`/`onAlignNext` 宿主回调。
  - 完成后 TimelineView.tsx 仅负责：
    - 计算 `timelineTasks`（调用现有 timeline-parser）
    - 调用 core 的 aggregation 函数
    - 选择用 SummaryTable 模式（年/季）还是每日时间轴模式（天/周/月）
    - 处理缩放/触控/点击创建任务等视图交互。

- TimeNavigator / ViewToolbar：
  - 将 TimeNavigator 顶部定义的 `getWeeksInYear` / `getMondayByWeek` / `getWeekRangeStr` 等时间工具移动到 `@core/utils/date` 或单独 `timeNavigator` util 中，TimeNavigator 只 import 使用，使 features/views 文件内只剩纯视图逻辑。
  - ViewToolbar 已经比较轻量，仅需要时可以把视图选项常量 `['年','季','月','周','天']` 放到 `@core/config/viewConfigs` 中统一，引入使用。

4. 目录和命名规范建议
- `src/core/config`
  - `viewConfigs.ts`：集中所有视图默认配置（StatisticsView / TimelineView / HeatmapView 等）。
  - 可继续保留或合并 `heatmapViewConfig.ts`。
- `src/core/utils`
  - `itemGrouping.ts`, `itemFilter.ts`：已有。
  - `statisticsAggregation.ts`, `dataAggregation.ts`：统计聚合。
  - `heatmapAggregation.ts`, `heatmapTemplate.ts`：Heatmap 相关工具。
  - `timelineAggregation.ts`：Timeline 聚合。
  - `date.ts`：通用日期相关工具，包括给 TimeNavigator 的 week/year 相关函数。
- `src/shared/ui`
  - `items/`：`TaskRow`, `FieldPill`, `ItemLink`, 后续的 TagList/CategoryBadge 等。
  - `heatmap/`：`HeatmapCell` 等。
  - `statistics/`：`ChartBlock`, 后续的 `StatisticsPopover` 等。
  - `timeline/`：`ProgressBlock`, `TimelineSummaryTable`, `DayColumnHeader`, `DayColumnBody` 等。

5. 效果
按此方案推进后：
- `src/features/views` 所有视图文件均达到“更纯净、更解耦”的目标：
  - 不再直写复杂的聚合/映射/tooltip 文案逻辑。
  - 多视图之间共用 Task/字段 UI、heatmap cell、统计图块等，显著减少重复。
- `src/core` 集中承载业务规则，更易于在未来增加新的视图或统计报表时复用。
- `src/shared/ui` 为视图提供一致的 UI 语言，视图只负责布局和组合，不关心内部的绘制细节。

你可以按此方案，优先完成 StatisticsView 的聚合切换和 ChartBlock 替换，然后逐步拆 TimelineView 和 TimeNavigator 的工具逻辑。如果需要在下一步直接对某个具体文件（例如 `StatisticsView.tsx`）做代码级改造，可以在后续任务中基于此方案继续实施。