# Vite æ„å»ºä¿®å¤æ€»ç»“

> **ä¿®å¤æ—¥æœŸ**: 2025-10-25  
> **çŠ¶æ€**: âœ… Vite æ„å»ºæˆåŠŸ | âš ï¸ TypeScript ç±»å‹æ£€æŸ¥æœ‰é”™è¯¯

---

## ğŸ“Š å½“å‰çŠ¶æ€

### âœ… å·²è§£å†³çš„é—®é¢˜

1. **Vite æ„å»ºæˆåŠŸ**
   ```
   dist/main.js  709.53 kB â”‚ gzip: 222.89 kB
   âœ“ built in 39.35s
   ```

2. **æ–‡ä»¶ç»“æ„æ‰å¹³åŒ–å®Œæˆ 70%**
   - âœ… `core/` â†’ `lib/`
   - âœ… `state/` â†’ `store/`
   - âœ… `shared/components/` â†’ `ui/`
   - âœ… `features/` â†’ `views/`

3. **è·¯å¾„å¯¼å…¥å…¨é¢ä¿®å¤**
   - ä¿®å¤äº† 78 ä¸ªæ–‡ä»¶çš„ 241 ä¸ªå¯¼å…¥è¯­å¥
   - æ‰€æœ‰åˆ«åå¯¼å…¥è½¬æ¢ä¸ºç›¸å¯¹è·¯å¾„å¯¼å…¥

### âš ï¸ å¾…è§£å†³çš„é—®é¢˜

**TypeScript ç¼–è¯‘é”™è¯¯: 1661 ä¸ª**

ä¸»è¦é”™è¯¯åˆ†ç±»ï¼š
1. **DataSource ç§»é™¤ç›¸å…³** (çº¦ 400 ä¸ªé”™è¯¯)
   - `AppStore.ts`: 25 ä¸ªé”™è¯¯
   - Settings ç›¸å…³: çº¦ 100 ä¸ªé”™è¯¯
   - å…¶ä»–ä¸šåŠ¡ä»£ç : çº¦ 275 ä¸ªé”™è¯¯

2. **MUI + Preact ç±»å‹å†²çª** (çº¦ 150 ä¸ªé”™è¯¯)
   - Dialog ç»„ä»¶: 20 ä¸ªé”™è¯¯
   - Form ç»„ä»¶: 50 ä¸ªé”™è¯¯
   - å…¶ä»– UI ç»„ä»¶: 80 ä¸ªé”™è¯¯

3. **æµ‹è¯•æ–‡ä»¶ç±»å‹é”™è¯¯** (çº¦ 1100 ä¸ªé”™è¯¯)
   - ç¼ºå°‘ Jest/Mocha ç±»å‹å®šä¹‰
   - æµ‹è¯• setup é—®é¢˜

4. **å…¶ä»–å°é”™è¯¯** (çº¦ 11 ä¸ªé”™è¯¯)
   - VaultWatcher äº‹ä»¶ç±»å‹
   - moment å¯¼å…¥é—®é¢˜
   - timing å‡½æ•° this ç±»å‹

---

## ğŸ”§ å·²å®Œæˆçš„ä¿®å¤å·¥ä½œ

### 1. Vite é…ç½®ä¼˜åŒ–

**æ–‡ä»¶**: `vite.config.ts`

```typescript
// ç§»é™¤äº†æœ‰é—®é¢˜çš„ vite-tsconfig-paths æ’ä»¶
// ä½¿ç”¨æ‰‹åŠ¨é…ç½®çš„è·¯å¾„åˆ«å
resolve: {
  alias: {
    'react': 'preact/compat',
    'react-dom': 'preact/compat',
    
    // é¡¹ç›®è·¯å¾„åˆ«å
    '@lib/services/core': path.resolve(__dirname, 'src/lib/services/core'),
    '@lib/types/domain': path.resolve(__dirname, 'src/lib/types/domain'),
    // ... æ›´å¤šåˆ«å
  }
}
```

**é—®é¢˜**: Vite çš„è·¯å¾„åˆ«åè§£ææœºåˆ¶ä¸ TypeScript ä¸åŒï¼Œ`vite-tsconfig-paths` æ— æ³•æ­£ç¡®å¤„ç†æ·±å±‚è·¯å¾„ã€‚

**è§£å†³**: è½¬æ¢æ‰€æœ‰åˆ«åå¯¼å…¥ä¸ºç›¸å¯¹è·¯å¾„å¯¼å…¥ã€‚

### 2. åˆ›å»ºè‡ªåŠ¨åŒ–è½¬æ¢è„šæœ¬

**æ–‡ä»¶**: `scripts/fix-vite-imports.js`

- è‡ªåŠ¨æ‰«ææ‰€æœ‰ `.ts` å’Œ `.tsx` æ–‡ä»¶
- å°†åˆ«åå¯¼å…¥ï¼ˆå¦‚ `@lib/xxx`ï¼‰è½¬æ¢ä¸ºç›¸å¯¹è·¯å¾„ï¼ˆå¦‚ `../../lib/xxx`ï¼‰
- å¤„ç†ç‰¹æ®Šæƒ…å†µï¼ˆå¦‚ `@shared/hooks`ï¼‰

**æ‰§è¡Œç»“æœ**:
```
å¤„ç†æ–‡ä»¶æ•°: 78
è½¬æ¢å¯¼å…¥æ•°: 241
```

### 3. åˆ›å»ºç¼ºå¤±çš„ Hooks

**æ–°å»ºæ–‡ä»¶**:
- `src/hooks/shared/useLocalStorage.ts` - localStorage çŠ¶æ€ç®¡ç†
- `src/hooks/shared/useClickOutside.ts` - ç‚¹å‡»å¤–éƒ¨æ£€æµ‹
- `src/hooks/shared/index.ts` - ç»Ÿä¸€å¯¼å‡º

è¿™äº› hooks ä¹‹å‰è¢«å¼•ç”¨ä½†ä¸å­˜åœ¨ï¼Œå¯¼è‡´æ„å»ºå¤±è´¥ã€‚

### 4. ä¿®å¤ç‰¹å®šæ–‡ä»¶çš„å¯¼å…¥é”™è¯¯

**æ‰‹åŠ¨ä¿®å¤çš„æ–‡ä»¶**:
1. `src/main.ts` - æ‰€æœ‰å¯¼å…¥æ”¹ä¸ºç›¸å¯¹è·¯å¾„
2. `src/lib/services/core/ActionService.ts` - ä¿®å¤ `readField` å¯¼å…¥
3. `src/views/Dashboard/ui/BlockView.tsx` - ä¿®å¤å¤šä¸ªç»„ä»¶å¯¼å…¥
4. `src/views/Dashboard/ui/TableView.tsx` - ä¿®å¤ UI ç»„ä»¶å¯¼å…¥
5. `src/ui/composites/TagsRenderer.tsx` - ä¿®å¤ `getCategoryColor` å¯¼å…¥
6. `src/views/Settings/ui/SettingsTab.tsx` - ä¿®å¤ hooks å¯¼å…¥
7. `src/views/Timer/ui/TimerView.tsx` - ä¿®å¤ hooks å¯¼å…¥
8. `src/ui/primitives/Modal.tsx` - ä¿®å¤ hooks å¯¼å…¥

### 5. è·¯å¾„æ˜ å°„ç»Ÿä¸€

**ä¿®å¤æ¨¡å¼**:
```
æ—§è·¯å¾„              â†’ æ–°è·¯å¾„
@core/domain       â†’ @lib/types/domain
@core/services     â†’ @lib/services/core
@state/            â†’ @store/
@shared/hooks      â†’ @hooks/shared
../../domain       â†’ ../../lib/types/domain
../../../ui/xxx    â†’ ../../../ui/composites/xxx
```

---

## ğŸ“ ä¿®æ”¹æ–‡ä»¶æ¸…å•

### é…ç½®æ–‡ä»¶
- [x] `vite.config.ts` - è·¯å¾„åˆ«åé…ç½®
- [x] `tsconfig.json` - è·¯å¾„æ˜ å°„ï¼ˆæœªæ”¹åŠ¨ï¼Œä¿æŒç°çŠ¶ï¼‰

### è„šæœ¬æ–‡ä»¶
- [x] `scripts/fix-vite-imports.js` - æ–°å»ºè‡ªåŠ¨åŒ–è½¬æ¢è„šæœ¬

### æ ¸å¿ƒæ–‡ä»¶
- [x] `src/main.ts` - ä¸»å…¥å£æ–‡ä»¶å¯¼å…¥ä¿®å¤

### Hooks
- [x] `src/hooks/shared/useLocalStorage.ts` - æ–°å»º
- [x] `src/hooks/shared/useClickOutside.ts` - æ–°å»º
- [x] `src/hooks/shared/index.ts` - æ–°å»º

### ä¸šåŠ¡æ–‡ä»¶ï¼ˆç¤ºä¾‹ï¼‰
- [x] `src/lib/services/core/ActionService.ts`
- [x] `src/views/Dashboard/ui/BlockView.tsx`
- [x] `src/views/Dashboard/ui/TableView.tsx`
- [x] `src/ui/composites/TagsRenderer.tsx`
- [x] `src/views/Settings/ui/SettingsTab.tsx`
- [x] `src/views/Timer/ui/TimerView.tsx`
- [x] `src/ui/primitives/Modal.tsx`

### æ‰¹é‡ä¿®æ”¹
- [x] 78 ä¸ªæ–‡ä»¶çš„ 241 ä¸ªå¯¼å…¥è¯­å¥ï¼ˆé€šè¿‡è„šæœ¬è‡ªåŠ¨å®Œæˆï¼‰

---

## ğŸ¯ å…³é”®æŠ€æœ¯å†³ç­–

### 1. ä¸ºä»€ä¹ˆç§»é™¤ `vite-tsconfig-paths`ï¼Ÿ

**é—®é¢˜**: 
- è¯¥æ’ä»¶æ— æ³•æ­£ç¡®è§£ææ·±å±‚è·¯å¾„ï¼ˆå¦‚ `@lib/services/core`ï¼‰
- å¯¼è‡´æ„å»ºæ—¶å‡ºç° "Rollup failed to resolve import" é”™è¯¯

**å†³ç­–**: 
- ä½¿ç”¨ç›¸å¯¹è·¯å¾„å¯¼å…¥ï¼Œé¿å… Vite çš„è·¯å¾„è§£æé—®é¢˜
- æ›´å¯é ï¼Œè™½ç„¶è·¯å¾„è¾ƒé•¿ä½†æ„å»ºç¨³å®š

### 2. ä¸ºä»€ä¹ˆä¸ä¿®å¤æ‰€æœ‰ TypeScript é”™è¯¯ï¼Ÿ

**åŸå› **:
- DataSource ç§»é™¤æ˜¯ä¸€ä¸ªå¤§å‹é‡æ„ï¼Œå½±å“é¢å¹¿
- MUI ç±»å‹é”™è¯¯éœ€è¦å…¨é¢æ›¿æ¢ UI ç»„ä»¶åº“
- æµ‹è¯•é”™è¯¯éœ€è¦é…ç½®æµ‹è¯•ç¯å¢ƒ

**å½“å‰ç­–ç•¥**:
- âœ… ä¼˜å…ˆä¿è¯ Vite æ„å»ºæˆåŠŸï¼ˆå·²å®Œæˆï¼‰
- â­ï¸ é€æ­¥ä¿®å¤ TypeScript é”™è¯¯ï¼ˆä¸‹ä¸€æ­¥ï¼‰
- ğŸ”„ åˆ†é˜¶æ®µè¿›è¡Œï¼Œæ¯æ­¥å¯éªŒè¯

### 3. ä¸ºä»€ä¹ˆä½¿ç”¨ç›¸å¯¹è·¯å¾„è€Œä¸æ˜¯åˆ«åï¼Ÿ

**å¯¹æ¯”**:
```typescript
// åˆ«åæ–¹å¼ï¼ˆTypeScript æ”¯æŒï¼ŒVite ä¸ç¨³å®šï¼‰
import { xxx } from '@lib/services/core';

// ç›¸å¯¹è·¯å¾„ï¼ˆTypeScript å’Œ Vite éƒ½æ”¯æŒï¼‰
import { xxx } from '../../lib/services/core';
```

**å†³ç­–ä¾æ®**:
- Vite å¯¹åˆ«åçš„æ”¯æŒä¸å¦‚ TypeScript å®Œå–„
- ç›¸å¯¹è·¯å¾„è™½ç„¶å†—é•¿ä½†æ›´å¯é 
- æœªæ¥å¯ä»¥è€ƒè™‘é‡æ–°å¼•å…¥åˆ«åï¼ˆå½“ Vite æ”¯æŒæ”¹å–„åï¼‰

---

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ„å»ºæ€§èƒ½
```
å½“å‰æ„å»º:
- æ€»æ—¶é—´: 39.35s
- åŒ…ä½“ç§¯: 709.53 KB
- Gzipped: 222.89 KB
- æ¨¡å—æ•°: 11,824

ç›®æ ‡ä¼˜åŒ–ï¼ˆç§»é™¤ MUI åï¼‰:
- åŒ…ä½“ç§¯: <200 KB (-72%)
- Gzipped: <70 KB (-69%)
```

### ç±»å‹æ£€æŸ¥æ€§èƒ½
```
å½“å‰çŠ¶æ€:
- TypeScript é”™è¯¯: 1,661 ä¸ª
- å½±å“æ–‡ä»¶: 64 ä¸ª
- ä¸»è¦é—®é¢˜: DataSource ç§»é™¤
```

---

## ğŸš¨ å·²çŸ¥é—®é¢˜

### 1. TypeScript ç±»å‹é”™è¯¯æœªå®Œå…¨ä¿®å¤

**å½±å“**: 
- IDE ä¼šæ˜¾ç¤ºå¤§é‡çº¢è‰²æ³¢æµªçº¿
- `tsc --noEmit` ä¼šå¤±è´¥
- ä½†ä¸å½±å“ Vite æ„å»º

**å»ºè®®**: 
- æŒ‰ä¼˜å…ˆçº§é€æ­¥ä¿®å¤ï¼ˆè§ä¸‹ä¸€æ­¥è®¡åˆ’ï¼‰

### 2. MUI å’Œ Preact ç±»å‹å†²çª

**åŸå› **: 
- MUI æ˜¯ React ç»„ä»¶åº“
- é¡¹ç›®ä½¿ç”¨ Preact
- ç±»å‹ç³»ç»Ÿä¸å…¼å®¹

**è§£å†³æ–¹æ¡ˆ**: 
- çŸ­æœŸ: æ·»åŠ ç±»å‹æ–­è¨€å¿½ç•¥é”™è¯¯
- é•¿æœŸ: æ›¿æ¢ä¸º Preact åŸç”Ÿç»„ä»¶ï¼ˆè§ä¼˜åŒ–è®¡åˆ’ï¼‰

### 3. æµ‹è¯•æ–‡ä»¶ç±»å‹é”™è¯¯

**åŸå› **: 
- ç¼ºå°‘ `@types/jest` æˆ– `@types/mocha`
- æµ‹è¯•é…ç½®ä¸å®Œæ•´

**è§£å†³æ–¹æ¡ˆ**: 
- å®‰è£…æµ‹è¯•ç±»å‹å®šä¹‰
- é…ç½®æµ‹è¯•ç¯å¢ƒ

---

## âœ… éªŒè¯æ¸…å•

### Vite æ„å»º
- [x] `npm run build` æˆåŠŸ
- [x] ç”Ÿæˆ `dist/main.js`
- [x] æ— æ„å»ºé”™è¯¯
- [x] Source map æ­£å¸¸ç”Ÿæˆ

### åŠŸèƒ½éªŒè¯ï¼ˆå»ºè®®ï¼‰
- [ ] åœ¨ Obsidian ä¸­åŠ è½½æ’ä»¶
- [ ] æµ‹è¯•æ ¸å¿ƒåŠŸèƒ½
- [ ] æ£€æŸ¥æ˜¯å¦æœ‰è¿è¡Œæ—¶é”™è¯¯

### TypeScript éªŒè¯
- [ ] `npx tsc --noEmit` æ— é”™è¯¯ï¼ˆå¾…å®Œæˆï¼‰
- [ ] IDE æ— ç±»å‹é”™è¯¯æç¤ºï¼ˆå¾…å®Œæˆï¼‰

---

## ğŸ“ ç»éªŒæ•™è®­

### 1. è·¯å¾„åˆ«åçš„å¤æ‚æ€§

**æ•™è®­**: Vite å’Œ TypeScript çš„è·¯å¾„è§£ææœºåˆ¶ä¸åŒï¼Œä½¿ç”¨æ—¶éœ€è°¨æ…ã€‚

**å»ºè®®**: 
- å¯¹äºå°é¡¹ç›®ï¼Œç›¸å¯¹è·¯å¾„æ›´å¯é 
- å¯¹äºå¤§é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨ workspace æœºåˆ¶

### 2. å¢é‡è¿ç§»çš„é‡è¦æ€§

**æ•™è®­**: ä¸€æ¬¡æ€§å¤§è§„æ¨¡é‡æ„é£é™©é«˜ã€‚

**å»ºè®®**:
- æ¯ä¸ªæ›´æ”¹ç‹¬ç«‹éªŒè¯
- ä¿æŒå¯å›æ»šæ€§
- åˆ†é˜¶æ®µè¿›è¡Œ

### 3. è‡ªåŠ¨åŒ–å·¥å…·çš„ä»·å€¼

**æ•™è®­**: æ‰‹åŠ¨ä¿®æ”¹ 78 ä¸ªæ–‡ä»¶éå¸¸è€—æ—¶ä¸”æ˜“é”™ã€‚

**å»ºè®®**:
- ç¼–å†™è‡ªåŠ¨åŒ–è„šæœ¬
- å……åˆ†æµ‹è¯•åæ‰¹é‡æ‰§è¡Œ
- ä¿ç•™è„šæœ¬ä»¥ä¾¿åç»­ä½¿ç”¨

---

## ğŸ“ ç›¸å…³èµ„æº

### æ–‡æ¡£
- [Vite è·¯å¾„åˆ«åé…ç½®](https://vitejs.dev/config/shared-options.html#resolve-alias)
- [TypeScript æ¨¡å—è§£æ](https://www.typescriptlang.org/docs/handbook/module-resolution.html)
- [Preact æ–‡æ¡£](https://preactjs.com/guide/v10/getting-started)

### ç›¸å…³æ–‡ä»¶
- `è®¡åˆ’.md` - æ¸è¿›å¼ä¼˜åŒ–è®¡åˆ’
- `æ¶æ„ä¼˜åŒ–è®¡åˆ’.md` - UI ç»„ä»¶åº“ä¼˜åŒ–è®¡åˆ’ï¼ˆæœªæ‰¾åˆ°å®Œæ•´ç‰ˆï¼‰
- `docs/refactoring/æ–‡ä»¶ç»“æ„æ‰å¹³åŒ–æ–¹æ¡ˆ.md` - ç»“æ„ä¼˜åŒ–æ–¹æ¡ˆ

### Git æäº¤
- `dceac9b` - Vite é…ç½®æ›´æ–°ï¼ˆæœ€æ–°æäº¤ï¼‰
- å»ºè®®ä¸ºæœ¬æ¬¡ä¿®å¤åˆ›å»ºæ–°çš„æäº¤

---

## ğŸ“… æ—¶é—´çº¿

| æ—¶é—´ | äº‹ä»¶ |
|------|------|
| 2025-10-25 10:00 | å¼€å§‹ä¿®å¤ Vite æ„å»ºé—®é¢˜ |
| 2025-10-25 10:30 | å‘ç°è·¯å¾„åˆ«åè§£æé—®é¢˜ |
| 2025-10-25 10:45 | åˆ›å»ºè‡ªåŠ¨åŒ–è½¬æ¢è„šæœ¬ |
| 2025-10-25 11:00 | æ‰¹é‡è½¬æ¢å¯¼å…¥è·¯å¾„ |
| 2025-10-25 11:15 | æ‰‹åŠ¨ä¿®å¤ç‰¹æ®Šæƒ…å†µ |
| 2025-10-25 11:19 | âœ… Vite æ„å»ºæˆåŠŸ |
| 2025-10-25 11:31 | ğŸ“ åˆ›å»ºä¿®å¤æ–‡æ¡£ |

---

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

è§ `docs/refactoring/TypeScripté”™è¯¯ä¿®å¤è®¡åˆ’.md`
