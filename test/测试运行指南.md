# Obsidian æ’ä»¶æµ‹è¯•è¿è¡ŒæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç»äº† Obsidian Sample Plugin é¡¹ç›®çš„å®Œæ•´æµ‹è¯•ä½“ç³»ï¼ŒåŒ…æ‹¬å„ç§æµ‹è¯•ç±»å‹çš„è¿è¡Œæ–¹æ³•ã€é…ç½®è¯´æ˜å’Œæœ€ä½³å®è·µã€‚

## ğŸ—‚ï¸ æµ‹è¯•æ¶æ„

### æµ‹è¯•æ¡†æ¶
- **Jest** - å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•ã€æ€§èƒ½æµ‹è¯•
- **WebdriverIO** - ç«¯åˆ°ç«¯æµ‹è¯•
- **è‡ªå®šä¹‰æµ‹è¯•è¿è¡Œå™¨** - ç»Ÿä¸€çš„æµ‹è¯•ç®¡ç†ç•Œé¢

### ç›®å½•ç»“æ„
```
â”œâ”€â”€ tests/                    # Jest æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ unit/                # å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ integration/         # é›†æˆæµ‹è¯•
â”‚   â”œâ”€â”€ performance/         # æ€§èƒ½æµ‹è¯•
â”‚   â”œâ”€â”€ fixtures/            # æµ‹è¯•æ•°æ®
â”‚   â””â”€â”€ helpers/             # æµ‹è¯•è¾…åŠ©å‡½æ•°
â”œâ”€â”€ test/                    # WebdriverIO æµ‹è¯•ç›®å½•
â”‚   â”œâ”€â”€ specs/               # E2E æµ‹è¯•è§„èŒƒ
â”‚   â”‚   â””â”€â”€ test.e2e.ts     # ç«¯åˆ°ç«¯æµ‹è¯•æ–‡ä»¶
â”‚   â””â”€â”€ vaults/              # æµ‹è¯•ç”¨çš„ Obsidian åº“
â”œâ”€â”€ test-configs/            # æµ‹è¯•é…ç½®
â”‚   â””â”€â”€ jest.config.js       # Jest é…ç½®
â”œâ”€â”€ test-utils/              # æµ‹è¯•å·¥å…·
â”‚   â””â”€â”€ setup/               # ç¯å¢ƒè®¾ç½®
â”œâ”€â”€ run-tests.js            # è‡ªå®šä¹‰æµ‹è¯•è¿è¡Œå™¨
â”œâ”€â”€ wdio.conf.mts           # WebdriverIO é…ç½®
â””â”€â”€ 1æµ‹è¯•æŒ‡ä»¤.js è¿è¡Œæµ‹è¯•    # å¿«é€Ÿæµ‹è¯•æŒ‡ä»¤
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ¨èçš„æµ‹è¯•æµç¨‹

1. **å¼€å‘é˜¶æ®µå¿«é€ŸéªŒè¯**
   ```bash
   node run-tests.js vscode  # VSCode æ€§èƒ½æµ‹è¯•
   node run-tests.js quick   # å¿«é€Ÿæµ‹è¯•ï¼ˆå•å…ƒ + æ„å»ºï¼‰
   ```

2. **åŠŸèƒ½å¼€å‘å®Œæˆ**
   ```bash
   node run-tests.js unit    # å•å…ƒæµ‹è¯•
   node run-tests.js e2e     # ç«¯åˆ°ç«¯æµ‹è¯•
   ```

3. **å‘å¸ƒå‰å®Œæ•´æµ‹è¯•**
   ```bash
   node run-tests.js all     # å®Œæ•´æµ‹è¯•å¥—ä»¶
   ```

## ğŸ“ è¯¦ç»†æµ‹è¯•å‘½ä»¤

### 1. Jest å•å…ƒæµ‹è¯•

#### åŸºç¡€å‘½ä»¤
```bash
# è¿è¡Œæ‰€æœ‰å•å…ƒæµ‹è¯•
npm run test

# ç›‘å¬æ¨¡å¼ï¼ˆæ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨é‡æ–°è¿è¡Œï¼‰
npm run test:watch

# ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
npm run test:coverage
```

#### åˆ†ç±»æµ‹è¯•
```bash
# åªè¿è¡Œå•å…ƒæµ‹è¯•
npm run test:unit

# è¿è¡Œé›†æˆæµ‹è¯•
npm run test:integration

# è¿è¡Œæ€§èƒ½æµ‹è¯•
npm run test:performance
```

#### Jest é…ç½®ç‰¹ç‚¹
- **æµ‹è¯•ç¯å¢ƒ**: jsdomï¼ˆæ¨¡æ‹Ÿæµè§ˆå™¨ç¯å¢ƒï¼‰
- **æ”¯æŒè¯­è¨€**: TypeScript + JavaScript
- **è·¯å¾„åˆ«å**: 
  - `@/` â†’ `src/`
  - `@tests/` â†’ `tests/`
  - `@test-utils/` â†’ `test-utils/`
- **è¶…æ—¶è®¾ç½®**: 10ç§’
- **è¦†ç›–ç‡**: æ’é™¤ `.d.ts` å’Œ `.stories` æ–‡ä»¶

### 2. WebdriverIO ç«¯åˆ°ç«¯æµ‹è¯•

#### åŸºç¡€å‘½ä»¤
```bash
# è¿è¡Œ E2E æµ‹è¯•
npm run test:e2e

# è¿è¡Œæ‰€æœ‰æµ‹è¯•ï¼ˆå•å…ƒ + E2Eï¼‰
npm run test:all
```

#### WebdriverIO é…ç½®ç‰¹ç‚¹
- **æµ‹è¯•æ¡†æ¶**: Mocha
- **å¹¶è¡Œå®ä¾‹**: æœ€å¤š4ä¸ªï¼ˆå¯é€šè¿‡ç¯å¢ƒå˜é‡ `WDIO_MAX_INSTANCES` è°ƒæ•´ï¼‰
- **æ”¯æŒå¹³å°**: 
  - æ¡Œé¢ç‰ˆ Obsidian
  - ç§»åŠ¨ç«¯æ¨¡æ‹Ÿï¼ˆ390x844 åˆ†è¾¨ç‡ï¼‰
- **æµ‹è¯•åº“**: `test/vaults/simple`
- **è¶…æ—¶è®¾ç½®**: 60ç§’

### 3. è‡ªå®šä¹‰æµ‹è¯•è¿è¡Œå™¨ (run-tests.js)

è¿™æ˜¯æ¨èçš„æµ‹è¯•ç®¡ç†æ–¹å¼ï¼Œæä¾›ç»Ÿä¸€çš„ç•Œé¢å’Œé¢å¤–çš„åŠŸèƒ½ã€‚

#### åŸºç¡€ç”¨æ³•
```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
node run-tests.js help

# å¿«é€Ÿæµ‹è¯•ï¼ˆæ¨èæ—¥å¸¸ä½¿ç”¨ï¼‰
node run-tests.js quick

# VSCode æ€§èƒ½æµ‹è¯•ï¼ˆæ¨èï¼‰
node run-tests.js vscode
```

#### å®Œæ•´å‘½ä»¤åˆ—è¡¨
```bash
node run-tests.js unit      # è¿è¡Œå•å…ƒæµ‹è¯•
node run-tests.js e2e       # è¿è¡Œç«¯åˆ°ç«¯æµ‹è¯•
node run-tests.js build     # æ„å»ºé¡¹ç›®
node run-tests.js perf      # æ˜¾ç¤ºæ€§èƒ½æµ‹è¯•è¯´æ˜
node run-tests.js manual    # æ˜¾ç¤ºæ‰‹åŠ¨æµ‹è¯•æ¸…å•
node run-tests.js vscode    # VSCodeç»ˆç«¯æ€§èƒ½æµ‹è¯•
node run-tests.js quick     # å¿«é€Ÿæµ‹è¯•ï¼ˆå•å…ƒæµ‹è¯• + æ„å»ºï¼‰
node run-tests.js all       # è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
node run-tests.js help      # æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
```

#### åŠŸèƒ½ç‰¹ç‚¹
- âœ… è‡ªåŠ¨æ£€æŸ¥å¿…è¦æ–‡ä»¶
- ğŸ¨ å½©è‰²è¾“å‡ºå’Œè¿›åº¦æç¤º
- ğŸ“Š è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- ğŸš€ æ™ºèƒ½çš„æµ‹è¯•æµç¨‹ç®¡ç†

### 4. æ€§èƒ½æµ‹è¯•

#### è‡ªåŠ¨åŒ–æ€§èƒ½æµ‹è¯•
```bash
# VSCode ç»ˆç«¯æ€§èƒ½æµ‹è¯•ï¼ˆæ¨èï¼‰
node run-tests.js vscode

# æˆ–ç›´æ¥è¿è¡Œ
node vscode-performance-test.js
```

#### æ‰‹åŠ¨æ€§èƒ½æµ‹è¯•
```bash
# æŸ¥çœ‹æ€§èƒ½æµ‹è¯•è¯´æ˜
node run-tests.js perf
```

æ‰‹åŠ¨æµ‹è¯•æ­¥éª¤ï¼š
1. æ‰“å¼€ Obsidian
2. æŒ‰ `Ctrl+Shift+I` æ‰“å¼€å¼€å‘è€…å·¥å…·
3. åˆ‡æ¢åˆ° Console æ ‡ç­¾
4. å¤åˆ¶ `çœŸå®æ€§èƒ½æµ‹è¯•.js` çš„å†…å®¹
5. ç²˜è´´åˆ°æ§åˆ¶å°å¹¶è¿è¡Œ
6. æ‰§è¡Œ `thinkPluginTests.runFullTestSuite()`

## ğŸ”§ æµ‹è¯•é…ç½®è¯¦è§£

### Jest é…ç½® (test-configs/jest.config.js)
```javascript
module.exports = {
  testEnvironment: 'jsdom',
  roots: ['../tests'],
  testMatch: [
    '**/tests/**/*.test.js',
    '**/tests/**/*.test.ts',
    '**/tests/**/*.spec.js',
    '**/tests/**/*.spec.ts'
  ],
  // ... æ›´å¤šé…ç½®
};
```

### WebdriverIO é…ç½® (wdio.conf.mts)
- æ”¯æŒå¤šç‰ˆæœ¬ Obsidian æµ‹è¯•
- è‡ªåŠ¨ä¸‹è½½å’Œç®¡ç† Obsidian ç‰ˆæœ¬
- ç§»åŠ¨ç«¯æ¨¡æ‹Ÿæ”¯æŒ
- å¹¶è¡Œæµ‹è¯•æ‰§è¡Œ

## ğŸ“Š æµ‹è¯•æŠ¥å‘Š

### è¦†ç›–ç‡æŠ¥å‘Š
è¿è¡Œ `npm run test:coverage` åï¼Œè¦†ç›–ç‡æŠ¥å‘Šå°†ç”Ÿæˆåœ¨ï¼š
- **æ§åˆ¶å°è¾“å‡º**: æ–‡æœ¬æ ¼å¼çš„è¦†ç›–ç‡æ‘˜è¦
- **HTML æŠ¥å‘Š**: `coverage/lcov-report/index.html`
- **LCOV æ–‡ä»¶**: `coverage/lcov.info`

### E2E æµ‹è¯•æŠ¥å‘Š
- ä½¿ç”¨ `obsidian-reporter` æ˜¾ç¤º Obsidian ç‰ˆæœ¬ä¿¡æ¯
- è¯¦ç»†çš„æµ‹è¯•æ­¥éª¤å’Œç»“æœ
- å¤±è´¥æ—¶çš„æˆªå›¾å’Œé”™è¯¯ä¿¡æ¯

## ğŸ› ï¸ å¼€å‘å·¥ä½œæµ

### æ—¥å¸¸å¼€å‘
```bash
# 1. å¿«é€ŸéªŒè¯
node run-tests.js vscode

# 2. å•å…ƒæµ‹è¯•
node run-tests.js unit

# 3. æ„å»ºéªŒè¯
node run-tests.js build
```

### åŠŸèƒ½å¼€å‘å®Œæˆ
```bash
# 1. å®Œæ•´è‡ªåŠ¨åŒ–æµ‹è¯•
node run-tests.js all

# 2. æ‰‹åŠ¨æµ‹è¯•æ¸…å•
node run-tests.js manual

# 3. æ€§èƒ½å›å½’æµ‹è¯•
node run-tests.js perf
```

### å‘å¸ƒå‰æ£€æŸ¥
```bash
# 1. æ¸…ç†ç¯å¢ƒ
npm run clean  # å¦‚æœæœ‰æ­¤å‘½ä»¤

# 2. å®Œæ•´æµ‹è¯•
node run-tests.js all

# 3. æ£€æŸ¥è¦†ç›–ç‡
npm run test:coverage

# 4. æœ€ç»ˆæ„å»º
npm run build
```

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

#### 1. Jest æµ‹è¯•å¤±è´¥
```bash
# æ£€æŸ¥é…ç½®
node run-tests.js help

# æŸ¥çœ‹è¯¦ç»†è¾“å‡º
npm run test -- --verbose

# è°ƒè¯•æ¨¡å¼
npm run test -- --detectOpenHandles
```

#### 2. E2E æµ‹è¯•å¤±è´¥
```bash
# æ£€æŸ¥ Obsidian ç‰ˆæœ¬
# æŸ¥çœ‹ wdio.conf.mts ä¸­çš„ç‰ˆæœ¬é…ç½®

# å•ç‹¬è¿è¡Œ E2E æµ‹è¯•
npm run test:e2e

# æ£€æŸ¥æµ‹è¯•åº“
ls test/vaults/
```

#### 3. æ€§èƒ½æµ‹è¯•é—®é¢˜
```bash
# æ£€æŸ¥æ€§èƒ½æµ‹è¯•æ–‡ä»¶
ls -la çœŸå®æ€§èƒ½æµ‹è¯•.js

# æŸ¥çœ‹ VSCode æ€§èƒ½æµ‹è¯•
node vscode-performance-test.js
```

### ç¯å¢ƒè¦æ±‚
- **Node.js**: æ¨è 18+ ç‰ˆæœ¬
- **npm**: æœ€æ–°ç‰ˆæœ¬
- **Obsidian**: ç”¨äº E2E æµ‹è¯•
- **VSCode**: ç”¨äºæ€§èƒ½æµ‹è¯•ï¼ˆå¯é€‰ï¼‰

## ğŸ“š æœ€ä½³å®è·µ

### 1. æµ‹è¯•ç¼–å†™
- ä½¿ç”¨æè¿°æ€§çš„æµ‹è¯•åç§°
- éµå¾ª AAA æ¨¡å¼ï¼ˆArrange, Act, Assertï¼‰
- ä¿æŒæµ‹è¯•çš„ç‹¬ç«‹æ€§
- ä½¿ç”¨åˆé€‚çš„æ–­è¨€åº“

### 2. æµ‹è¯•ç»„ç»‡
- æŒ‰åŠŸèƒ½æ¨¡å—ç»„ç»‡æµ‹è¯•æ–‡ä»¶
- ä½¿ç”¨ `fixtures` ç›®å½•ç®¡ç†æµ‹è¯•æ•°æ®
- åœ¨ `helpers` ä¸­å®šä¹‰å¯é‡ç”¨çš„æµ‹è¯•å·¥å…·

### 3. æŒç»­é›†æˆ
- åœ¨ CI/CD ä¸­è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶
- è®¾ç½®è¦†ç›–ç‡é˜ˆå€¼
- è‡ªåŠ¨åŒ–æ€§èƒ½å›å½’æ£€æµ‹

### 4. æ€§èƒ½ç›‘æ§
- å®šæœŸè¿è¡Œæ€§èƒ½æµ‹è¯•
- ç›‘æ§å…³é”®æŒ‡æ ‡å˜åŒ–
- å»ºç«‹æ€§èƒ½åŸºçº¿

## ğŸ”— ç›¸å…³æ–‡ä»¶

- **package.json**: åŒ…å«æ‰€æœ‰æµ‹è¯•è„šæœ¬
- **run-tests.js**: è‡ªå®šä¹‰æµ‹è¯•è¿è¡Œå™¨
- **test-configs/jest.config.js**: Jest é…ç½®
- **wdio.conf.mts**: WebdriverIO é…ç½®
- **çœŸå®æ€§èƒ½æµ‹è¯•.js**: æ‰‹åŠ¨æ€§èƒ½æµ‹è¯•è„šæœ¬
- **vscode-performance-test.js**: VSCode æ€§èƒ½æµ‹è¯•

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š
1. è¿è¡Œ `node run-tests.js help` æŸ¥çœ‹å¯ç”¨é€‰é¡¹
2. æ£€æŸ¥æµ‹è¯•é…ç½®æ–‡ä»¶
3. æŸ¥çœ‹æµ‹è¯•è¾“å‡ºä¸­çš„é”™è¯¯ä¿¡æ¯
4. å‚è€ƒé¡¹ç›®æ–‡æ¡£å’Œç¤ºä¾‹

---

*æœ€åæ›´æ–°: 2025å¹´10æœˆ6æ—¥*
