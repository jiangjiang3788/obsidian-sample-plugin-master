# ThinkPlugin 启动性能优化分析

## 当前启动流程问题

### 1. 同步依赖注入解析过多服务
```typescript
// 当前代码在主线程中同步解析所有服务
this.appStore = container.resolve(AppStore);
this.dataStore = container.resolve(DataStore);
this.rendererService = container.resolve(RendererService);
this.actionService = container.resolve(ActionService);
this.timerService = container.resolve(TimerService);
this.timerStateService = container.resolve(TimerStateService);
this.inputService = container.resolve(InputService);
```

### 2. setTimeout(0) 的误用
```typescript
setTimeout(async () => {
    // 大量初始化工作
    await this.dataStore.initialScan(); // 可能很慢
    // ... 其他初始化
}, 0);
```
`setTimeout(0)` 不会真正延迟执行，只是推迟到下一个事件循环，仍然阻塞启动。

### 3. 数据存储初始化可能很慢
```typescript
await this.dataStore.initialScan(); // 可能扫描大量文件
```

### 4. 所有特性都同步加载
Dashboard、QuickInput、Settings 等特性都在启动时同步加载。

## 优化方案

### 1. 懒加载服务
只解析启动必需的服务，其他服务按需加载。

### 2. 真正的异步初始化
使用微任务或分片初始化，避免阻塞主线程。

### 3. 延迟非关键特性
将 Dashboard、Settings 等特性延迟到真正需要时才加载。

### 4. 优化数据扫描
增量扫描或后台扫描数据文件。

## 实施计划

1. **第一阶段**: 实现服务懒加载
2. **第二阶段**: 优化数据初始化
3. **第三阶段**: 延迟特性加载
4. **第四阶段**: 性能监控和测试
