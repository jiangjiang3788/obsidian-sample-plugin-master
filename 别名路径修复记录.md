# Obsidian 插件别名路径修复记录

## 修复概述
将项目中所有使用相对路径的导入语句批量修改为使用别名引用，解决路径冲突问题，提高代码可维护性。

## 修复时间
2025年11月11日

## 修复内容

### 1. 配置文件更新

#### tsconfig.json
添加了完整的路径别名配置：
```json
{
  "compilerOptions": {
    "paths": {
      "@/*": ["src/*"],
      "@lib/*": ["src/lib/*"],
      "@store/*": ["src/store/*"],
      "@ui/*": ["src/ui/*"],
      "@views/*": ["src/views/*"],
      "@hooks/*": ["src/hooks/*"],
      "@config/*": ["src/config/*"],
      "@platform/*": ["src/platform/*"],
      "@main": ["src/main.ts"]
    }
  }
}
```

#### vite.config.ts
配置了对应的别名映射：
```typescript
resolve: {
  alias: {
    '@': path.resolve(process.cwd(), 'src'),
    '@lib': path.resolve(process.cwd(), 'src/lib'),
    '@store': path.resolve(process.cwd(), 'src/store'),
    '@ui': path.resolve(process.cwd(), 'src/ui'),
    '@views': path.resolve(process.cwd(), 'src/views'),
    '@hooks': path.resolve(process.cwd(), 'src/hooks'),
    '@config': path.resolve(process.cwd(), 'src/config'),
    '@platform': path.resolve(process.cwd(), 'src/platform'),
  }
}
```

### 2. 冲突解决
- 移除了 `vite-tsconfig-paths` 插件以避免冲突
- 重命名冲突的 `vite.config.mjs` 为 `vite.config.mjs.backup`

### 3. 已修复文件列表

#### 核心入口文件
- ✅ `src/main.ts` - 主入口文件的所有导入
- ✅ `src/store/AppStore.ts` - 应用状态管理

#### 视图组件
- ✅ `src/views/Settings/index.ts` - 设置页面导入
- ✅ `src/views/Settings/ui/ThemeMatrix/index.tsx` - 主题矩阵组件
- ✅ `src/views/Timer/TimerWidget.ts` - 计时器组件
- ✅ `src/views/Timer/FloatingTimerWidget.ts` - 浮动计时器组件
- ✅ `src/views/QuickInput/index.ts` - 快速输入功能
- ✅ `src/views/Dashboard/index.ts` - 仪表板功能

#### 服务文件
- ✅ `src/lib/services/core/TimerService.ts` - 计时器服务

#### 配置文件
- ✅ `src/views/Settings/ui/components/RuleBuilder.tsx` - JSX配置修复

### 4. 修复示例

#### 修复前
```typescript
import { AppStore } from '../../../store/AppStore';
import { DataStore } from '../services/core/dataStore';
import type ThinkPlugin from '../../main';
```

#### 修复后
```typescript
import { AppStore } from '@store/AppStore';
import { DataStore } from '@lib/services/core/dataStore';
import type ThinkPlugin from '@main';
```

## 构建验证
- ✅ 构建成功，无路径解析错误
- ✅ 生成文件大小：700.16 kB (gzip: 221.02 kB)
- ✅ 所有模块转换正常

## 待修复文件统计
剩余约124个相对路径导入需要处理，主要分布在：

### 高优先级
- `src/lib/services/core/` - 核心服务文件
- `src/store/stores/` - 状态存储文件
- `src/lib/utils/core/` - 核心工具函数

### 中优先级
- `src/views/Settings/ui/ThemeMatrix/` - 主题矩阵相关文件
- `src/views/Dashboard/` - 仪表板相关文件
- `src/lib/logic/` - 业务逻辑文件

### 低优先级
- `src/lib/types/` - 类型定义文件
- `src/constants/` - 常量文件

## 修复原则
1. **保持功能不变** - 只修改导入路径，不改变业务逻辑
2. **逐步验证** - 每修复一批文件后进行构建验证
3. **优先核心** - 先修复核心服务和高频使用文件
4. **统一规范** - 使用一致的别名命名规范

## 下一步计划
1. 继续修复 `src/lib/services/core/` 目录下的服务文件
2. 处理 `src/store/stores/` 目录下的存储文件
3. 修复 `src/lib/utils/core/` 目录下的工具函数
4. 最后处理类型定义和常量文件

## 注意事项
- 某些文件存在类型错误，但这些是现有代码问题，不是路径替换造成的
- 修复过程中如遇到构建错误，需要检查别名配置是否正确
- 建议在修复重要文件前先备份
