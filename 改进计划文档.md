# Think OS 插件渐进式改进计划

## 项目概述
- **项目名称**：Think OS (Obsidian插件)
- **开始时间**：2025/10/7
- **改进原则**：小步快跑、测试驱动、随时可回退

## 改进进度跟踪

### ✅ 第0步：环境准备和测试基线（已完成）
- 时间：2025/10/7 下午1:12
- 建立测试基线（构建成功，57个测试通过）
- 创建测试基线记录文档

### ✅ 第1步：整理测试文件结构（已完成）
- 时间：2025/10/7 下午1:19
- 统一测试目录到 `test/`
- 删除旧测试目录和重复配置文件
- 创建清晰的测试目录结构
- 验证：所有测试通过

### 🔄 第2步：统一路径别名和桶文件（进行中）
- **目标**：
  1. 完善路径别名配置
  2. 为每个模块创建桶文件（index.ts）
  3. 简化import语句
  
- **具体任务**：
  - [ ] 检查并完善路径别名配置
  - [ ] 为 src/core 创建桶文件
  - [ ] 为 src/state 创建桶文件
  - [ ] 为 src/platform 创建桶文件
  - [ ] 为 src/shared 创建桶文件
  - [ ] 为 src/features 各子模块创建桶文件
  - [ ] 逐步更新import语句使用路径别名
  - [ ] 测试验证每个改动

### ⏳ 第3步：处理重复文件
- **目标**：
  - [ ] 分析 main.ts 和 main2.ts 的差异
  - [ ] 决定保留或合并
  - [ ] 清理其他重复代码

### ⏳ 第4步：核心架构改进

#### 4.1 主题管理重构（高优先级）
- **问题**：主题录入没有分组，管理混乱
- **解决方案**：
  - [ ] 实现主题层级结构
  - [ ] 添加主题分组功能
  - [ ] 支持主题状态管理（active/inactive/archived）
  - [ ] 创建主题管理界面

#### 4.2 简化视图配置（高优先级）
- **问题**：视图配置与主题分离，配置复杂
- **解决方案**：
  - [ ] 集成视图配置到视图组件
  - [ ] 提供可视化配置界面
  - [ ] 减少配置文件复杂度
  - [ ] 支持视图内直接配置

#### 4.3 统一数据查询逻辑（中优先级）
- **问题**：主题和tags混淆，查询不统一
- **解决方案**：
  - [ ] 明确区分themes和tags
  - [ ] 建立清晰的映射关系
  - [ ] 统一查询接口

#### 4.4 优化Block配置（中优先级）
- **问题**：配置继承层级过深
- **解决方案**：
  - [ ] 简化为两层：全局配置 -> 主题配置
  - [ ] 提供清晰的覆写规则
  - [ ] 改进配置界面

#### 4.5 重构时间查询系统（低优先级）
- **问题**：时间查询逻辑混乱
- **解决方案**：
  - [ ] 提供预设时间范围
  - [ ] 简化周期查询配置
  - [ ] 统一概览视图时间逻辑

## 路径别名规范

### 已配置的路径别名
```typescript
@core      -> src/core       // 核心业务逻辑
@state     -> src/state      // 状态管理
@platform  -> src/platform   // 平台适配层
@features  -> src/features   // 功能模块
@shared    -> src/shared     // 共享工具
```

### 桶文件（index.ts）规范
每个模块根目录应有 index.ts 导出所有公共接口：

```typescript
// src/core/index.ts 示例
export * from './domain';
export * from './services';
export * from './utils';
```

### Import简化示例
```typescript
// 改进前：
import { DataStore } from '../../../core/services/DataStore';
import { AppStore } from '../../../state/AppStore';
import { Item } from '../../../core/domain/schema';

// 改进后：
import { DataStore } from '@core/services';
import { AppStore } from '@state';
import { Item } from '@core/domain';

// 或使用桶文件后：
import { DataStore, Item } from '@core';
import { AppStore } from '@state';
```

## 测试策略

### 每步必做
1. 修改前运行测试，记录结果
2. 进行小范围修改
3. 修改后运行测试，对比结果
4. 确认功能正常后继续

### 测试命令
```bash
npm test          # 运行所有测试
npm run build     # 构建测试
npm test:unit     # 单元测试
npm test:integration  # 集成测试
```

## 风险管理

### 回退策略
- 每个大步骤前创建git commit
- 保留修改前的文件备份
- 记录每步的修改内容

### 注意事项
1. 不要一次修改太多文件
2. 优先修改叶子节点（被依赖少的模块）
3. 保持测试始终通过
4. 遇到问题立即停止并分析

## 进度记录

| 日期 | 完成内容 | 测试结果 | 备注 |
|------|---------|---------|------|
| 2025/10/7 13:12 | 建立测试基线 | ✅ 57/57 | 初始状态 |
| 2025/10/7 13:19 | 整理测试文件 | ✅ 57/57 | 目录结构优化 |
| 2025/10/7 13:26 | 开始路径别名改进 | - | 进行中 |

---
*此文档将持续更新，记录每个改进步骤的进展*
