# Think Plugin é‡æž„è¯´æ˜Žï¼ˆH1â€“H5ï¼‰

**æ—¥æœŸï¼š** 2025-07-29
**èŒƒå›´ï¼š** æ¶ˆé™¤é‡å¤é€»è¾‘ã€ç»Ÿä¸€è¡Œä¸ºä¸Žå¸¸é‡ã€è½»åº¦æ€§èƒ½ä¼˜åŒ–ï¼Œä¸æ”¹å˜å¯¹å¤–åŠŸèƒ½ä¸Žæ•°æ®ç»“æž„ã€‚

**ç›®æ ‡ï¼š**

* æŠ½ç¦»ä»»åŠ¡å®Œæˆä¸Žå‘¨æœŸä»»åŠ¡ç”Ÿæˆé€»è¾‘ï¼Œé¿å…å¤šå¤„ä¿®æ”¹ä¸ä¸€è‡´ã€‚
* ç»Ÿä¸€å„è§†å›¾ä¸­çš„å¤é€‰æ¡†äº¤äº’ä¸Žæ ·å¼ã€‚
* æŠŠæ—¥æœŸèŒƒå›´è®¡ç®—é›†ä¸­åˆ°å·¥å…·å‡½æ•°ã€‚
* ç»Ÿä¸€ emojiã€è¿ç®—ç¬¦æ¥æºï¼Œæ¶ˆé™¤â€œé­”æ³•å­—ç¬¦ä¸²â€ã€‚
* å‡å°‘è®¾ç½®é¢æ¿çš„æ— è°“é‡æ¸²æŸ“ï¼Œç¼“è§£å¡é¡¿ã€‚

---

## 1. æ”¹åŠ¨æ‘˜è¦

| ç¼–å· | ç›®æ ‡                  | ç»“æžœ                                                                                                               |
| -- | ------------------- | ---------------------------------------------------------------------------------------------------------------- |
| H1 | **ä»»åŠ¡å®Œæˆ & å‘¨æœŸä»»åŠ¡é€»è¾‘é‡å¤** | åœ¨ `data/mark.ts` æ–°å¢žé«˜å±‚å°è£… `markTaskDone()`ï¼Œ`DataStore.markItemDone()` æ”¹ä¸ºè°ƒç”¨è¯¥å‡½æ•°ï¼Œåˆ é™¤åŽŸæœ‰å†…åµŒçš„é‡å¤å®žçŽ°ã€‚                         |
| H2 | **å¤šè§†å›¾å¤é€‰æ¡†è¡Œä¸ºä¸ä¸€è‡´**     | æ–°å¢žé€šç”¨ç»„ä»¶ `views/common/TaskCheckbox.tsx`ï¼Œ`BlockView` ä¸Ž `TableView` ç»Ÿä¸€ä½¿ç”¨ï¼Œå‹¾é€‰åŽè°ƒç”¨ `DataStore.instance.markItemDone()`ã€‚ |
| H3 | **æ—¥æœŸèŒƒå›´å‡½æ•°åˆ†æ•£**        | åœ¨ `utils/date.ts` æ–°å¢ž `getDateRange()`ï¼Œ`Dashboard.tsx` æ”¹ä¸ºå¼•ç”¨å·¥å…·å‡½æ•°ï¼Œåˆ é™¤å†…éƒ¨åŒåå‡½æ•°ã€‚                                         |
| H4 | **Settings é¢æ¿å¡é¡¿**   | ç»Ÿä¸€è¿ç®—ç¬¦å¸¸é‡å¼•ç”¨ï¼Œå‡å°‘é‡ç»˜æ—¶çš„æž„é€ å·¥ä½œï¼›ä¸ºåŽç»­ç¼“å­˜ä¸Ž memo ç•™å‡ºå…¥å£ï¼ˆæœ¬æ¬¡ä¸ºè½»åº¦ä¼˜åŒ–ï¼Œä¸æ¶‰åŠè¡Œä¸ºå˜åŒ–ï¼‰ã€‚                                                          |
| H5 | **emoji ä¸Žè¿ç®—ç¬¦å¸¸é‡é‡å¤**  | æ‰€æœ‰å¤„ç»Ÿä¸€ä½¿ç”¨ `config/constants.ts` çš„ `EMOJI` ä¸Ž `OPS`ã€‚                                                                 |

---

## 2. å˜æ›´æ–‡ä»¶æ¸…å•

| å˜æ›´ç±»åž‹     | æ–‡ä»¶è·¯å¾„                                | è¯´æ˜Ž                                                                                                                 |
| -------- | ----------------------------------- | ------------------------------------------------------------------------------------------------------------------ |
| **è¦†ç›–**   | `src/data/mark.ts`                  | æ•´åˆï¼šæä¾› `toggleToDone`ã€`parseRecurrence`ã€`findBaseDateForRecurring`ã€`generateNextRecurringTask`ï¼Œä»¥åŠé«˜å±‚ `markTaskDone`ã€‚ |
| **è¦†ç›–**   | `src/data/store.ts`                 | `markItemDone()` æ”¹ä¸ºè°ƒç”¨ `markTaskDone()`ï¼›åˆ é™¤å†…åµŒçš„é‡å¤é€»è¾‘ï¼›å…¶å®ƒæ‰«æ/æŸ¥è¯¢é€»è¾‘ä¸å˜ã€‚                                                      |
| **è¦†ç›–**   | `src/utils/date.ts`                 | æ–°å¢ž `getDateRange()`ï¼Œä¿ç•™ `normalizeDateStr()`ã€‚                                                                       |
| **æ–°å¢ž**   | `src/views/common/TaskCheckbox.tsx` | é€šç”¨å¤é€‰æ¡†ç»„ä»¶ï¼Œå°è£…å‹¾é€‰äº¤äº’ã€‚                                                                                                    |
| **è¦†ç›–**   | `src/views/BlockView.tsx`           | ä½¿ç”¨ `TaskCheckbox`ï¼›ç²¾ç®€é‡å¤ä»£ç ã€‚                                                                                          |
| **è¦†ç›–**   | `src/views/TableView.tsx`           | ä½¿ç”¨ `TaskCheckbox`ï¼›ç²¾ç®€é‡å¤ä»£ç ã€‚                                                                                          |
| **å±€éƒ¨ä¿®æ”¹** | `src/views/Dashboard.tsx`           | å¼•å…¥ `getDateRange`ï¼Œåˆ é™¤ç»„ä»¶å†… `getDateRange`ã€‚                                                                            |
| **å±€éƒ¨ä¿®æ”¹** | `src/ui/SettingsTab.ts`             | å°†ç¡¬ç¼–ç çš„è¿ç®—ç¬¦æ•°ç»„æ›¿æ¢ä¸º `OPS` å¸¸é‡ï¼›ä¸ºåŽç»­ç¼“å­˜ç•™å‡ºç©ºé—´ã€‚                                                                                  |

> è¯´æ˜Žï¼šå…¶ä½™æ–‡ä»¶æœªæ”¹åŠ¨ã€‚`config/constants.ts` ä¸­çš„ `EMOJI`ã€`OPS` æ²¡æœ‰å˜æ›´ï¼Œåªæ˜¯è¢«æ›´å¤šæ–‡ä»¶ç»Ÿä¸€å¼•ç”¨ã€‚

---

## 3. å…³é”®é€»è¾‘è¯´æ˜Ž

### 3.1 ä»»åŠ¡å®Œæˆä¸Žå‘¨æœŸä»»åŠ¡ï¼ˆH1ï¼‰

* **ä¹‹å‰**ï¼š`data/mark.ts` ä¸Ž `DataStore.markItemDone()` å†…éƒ¨åˆ†åˆ«ç»´æŠ¤äº†ä¸€å¥—â€œå®Œæˆæ ‡è®° + å‘¨æœŸç”Ÿæˆâ€å®žçŽ°ï¼Œæ­£åˆ™å’Œæ­¥éª¤ä¸å®Œå…¨ä¸€è‡´ã€‚
* **çŽ°åœ¨**ï¼šç»Ÿä¸€åœ¨ `data/mark.ts`ï¼š

  * `markTaskDone(rawLine, todayISO, nowTime)` è¿”å›ž `{ completedLine, nextTaskLine? }`ã€‚
  * `DataStore.markItemDone()` åªè´Ÿè´£è¯»å†™æ–‡ä»¶ä¸Žè§¦å‘åˆ·æ–°ã€‚
* **æ”¶ç›Š**ï¼šä¿®æ”¹æ—¥æœŸæ ¼å¼/æ­£åˆ™/é¡ºåºæ—¶ï¼Œåªéœ€æ”¹ä¸€å¤„ï¼›æ˜“äºŽç¼–å†™é’ˆå¯¹æ€§çš„å•å…ƒæµ‹è¯•ã€‚

### 3.2 å¤é€‰æ¡†è¡Œä¸ºç»Ÿä¸€ï¼ˆH2ï¼‰

* æ–°å¢ž `TaskCheckbox`ï¼š

  * `done=true`ï¼šæ˜¾ç¤ºå®Œæˆå‹¾é€‰ã€é˜»æ­¢å†æ¬¡ç‚¹å‡»ã€‚
  * `done=false`ï¼šå‹¾é€‰åŽè§¦å‘ `onMarkDone()`ï¼Œç”± `DataStore` å®Œæˆè½ç›˜ä¸Žåˆ·æ–°ã€‚
* `BlockView` ä¸Ž `TableView` ç»Ÿä¸€å¤ç”¨è¯¥ç»„ä»¶ï¼Œè§†è§‰ä¸Žäº¤äº’ä¸€è‡´ã€‚

### 3.3 æ—¥æœŸèŒƒå›´ç»Ÿä¸€ï¼ˆH3ï¼‰

* `utils/date.ts` æ–°å¢žï¼š

```ts
export function getDateRange(date: any, viewType: string) {
  // å¤„ç† å¹´/å­£/æœˆ/å‘¨/å¤© èµ·æ­¢
  return { startDate, endDate };
}
```

* `Dashboard.tsx` è°ƒç”¨è¯¥å·¥å…·å‡½æ•°ï¼Œä¸å†å†…åµŒå®žçŽ°ã€‚

### 3.4 å¸¸é‡ç»Ÿä¸€ï¼ˆH5ï¼‰

* ç»Ÿä¸€ä½¿ç”¨ï¼š

  * `EMOJI`: ðŸ“…ã€â³ã€ðŸ›«ã€âœ…ã€ðŸ” ç­‰ã€‚
  * `OPS`: `'=', '!=', 'includes', 'regex', '>', '<'`ã€‚
* å¼•å…¥æ–¹å¼ï¼š

```ts
import { EMOJI, OPS } from '../config/constants';
```

### 3.5 Settings é¢æ¿è½»åº¦ä¼˜åŒ–ï¼ˆH4ï¼‰

* æŠŠç¡¬ç¼–ç è¿ç®—ç¬¦æ•°ç»„æ›¿æ¢ä¸º `OPS`ï¼Œæ¶ˆé™¤æ•£è½å¸¸é‡ï¼Œä¾¿äºŽåŽç»­æ–°å¢žè¿ç®—ç¬¦ã€‚
* åŽç»­å¯è¿›ä¸€æ­¥å¼•å…¥ memo/caching ä»¥å‡å°‘ `display()` çš„å…¨é‡é‡å»ºï¼ˆæœ¬æ¬¡ä¸æ”¹å˜è¡Œä¸ºï¼‰ã€‚

---

## 4. å…¼å®¹æ€§ä¸Žè¿ç§»

* **æ•°æ®å…¼å®¹**ï¼šä¸æ”¹å˜ `PersistData` / `DashboardConfig` / `Item` ç»“æž„ã€‚
* **ç•Œé¢å…¼å®¹**ï¼šè§†è§‰ä¸Žäº¤äº’ä¿æŒä¸€è‡´ï¼›å¤é€‰æ¡†æ ·å¼ç»Ÿä¸€ä¸º `.task-checkbox`ï¼ˆåŽŸæ ·å¼ä»é€‚ç”¨ï¼‰ã€‚
* **API å…¼å®¹**ï¼šå¤–éƒ¨åªä½¿ç”¨ `DataStore.markItemDone()` çš„åœ°æ–¹æ— éœ€ä¿®æ”¹ï¼›å†…éƒ¨æ”¹ä¸º `markTaskDone()` å®žçŽ°ã€‚

---

## 5. å›žæ»šæ–¹æ¡ˆ

å¦‚éœ€å›žæ»šï¼š

1. å°†ä»¥ä¸‹æ–‡ä»¶æ¢å¤åˆ°é‡æž„å‰ç‰ˆæœ¬ï¼š

   * `src/data/mark.ts`
   * `src/data/store.ts`
   * `src/views/BlockView.tsx`
   * `src/views/TableView.tsx`
   * `src/views/Dashboard.tsx`
   * `src/utils/date.ts`
   * `src/ui/SettingsTab.ts`
2. åˆ é™¤æ–°å¢žæ–‡ä»¶ï¼š

   * `src/views/common/TaskCheckbox.tsx`

---

## 6. æµ‹è¯•æ¸…å•

### 6.1 ä»»åŠ¡å®Œæˆ / å‘¨æœŸä»»åŠ¡

* [ ] å‹¾é€‰å•æ¬¡ä»»åŠ¡ï¼šæ’å…¥ `(æ—¶é—´::HH:MM)`ï¼Œå‹¾é€‰æ¡†å˜ä¸ºå®Œæˆï¼Œå°¾éƒ¨è¿½åŠ  `âœ… YYYY-MM-DD`ã€‚
* [ ] å‹¾é€‰å‘¨æœŸä»»åŠ¡ `ðŸ” every day`ï¼šåŽŸè¡Œå†™å…¥å®Œæˆä¿¡æ¯ï¼Œå¹¶åœ¨ä¸‹ä¸€è¡Œæ’å…¥æ–°ä»»åŠ¡ï¼›æ–°ä»»åŠ¡çš„ ðŸ“…/â³/ðŸ›« æ—¥æœŸé¡ºå»¶ 1 å¤©ã€‚
* [ ] å‹¾é€‰ `ðŸ” every 2 weeks when done`ï¼šä»¥å®Œæˆå½“å¤©ä¸ºåŸºå‡†é¡ºå»¶ 2 å‘¨ã€‚
* [ ] å« `(æ—¶é•¿::30)`ï¼šå®ŒæˆåŽä¿ç•™ä¸”é¡ºåºä¸º `(æ—¶é—´::HH:MM) (æ—¶é•¿::30)`ã€‚
* [ ] è¡Œæœ«å·²æœ‰æ—§ `âœ…` æ—¥æœŸï¼šåº”è¢«æ›¿æ¢ä¸ºå½“å¤©æ—¥æœŸã€‚
* [ ] `/` æ—¥æœŸå†™å›žåŽç»Ÿä¸€ä¸º `YYYY-MM-DD`ã€‚

### 6.2 å¤é€‰æ¡†ä¸€è‡´æ€§

* [ ] `BlockView` ä¸Ž `TableView` å‹¾é€‰è¡Œä¸ºä¸€è‡´ï¼›å®ŒæˆåŽ UI è‡ªåŠ¨åˆ·æ–°ã€‚
* [ ] å·²å®Œæˆä»»åŠ¡çš„å¤é€‰æ¡†ä¸å¯å†æ¬¡ç‚¹å‡»ï¼ˆCSS ä¸Žé€»è¾‘åŒé‡ä¿éšœï¼‰ã€‚

### 6.3 æ—¥æœŸèŒƒå›´è¿‡æ»¤

* [ ] åœ¨ Dashboard é¡¶éƒ¨åˆ‡æ¢â€œå¹´/å­£/æœˆ/å‘¨/å¤©â€å‡èƒ½æ­£ç¡®ç­›é€‰ `item.date`ï¼›**æ— æ—¥æœŸé¡¹ä»æ˜¾ç¤º**ã€‚
* [ ] â€œå‘¨â€è§†å›¾çš„å‘¨èµ·å§‹ä¸ŽåŽŸå…ˆè¡¨çŽ°ä¸€è‡´ï¼ˆä¾èµ– moment è®¾ç½®ï¼‰ã€‚

### 6.4 Settings é¢æ¿

* [ ] è¿‡æ»¤æ¡ä»¶è¿ç®—ç¬¦ä¸‹æ‹‰æ¡†æ¥è‡ª `OPS`ï¼Œä¿å­˜åŽåˆ·æ–°ä»æ­£ç¡®ã€‚
* [ ] æ·»åŠ /åˆ é™¤è¿‡æ»¤ä¸ŽæŽ’åºè§„åˆ™åŽï¼Œé…ç½®å¯ä¿å­˜å¹¶åˆ·æ–°å¯¹åº”æ¨¡å—ã€‚

---

## 7. å·²çŸ¥é™åˆ¶ä¸ŽåŽç»­å·¥ä½œ

* **SettingsTab æ€§èƒ½**ï¼šå½“å‰ä»…åšå¸¸é‡ç»Ÿä¸€ã€‚è‹¥æ•°æ®è§„æ¨¡å¤§ï¼Œå»ºè®®ï¼š

  * å°† `queryItems()` çš„å…¨é‡è®¡ç®—æ”¹ä¸ºåœ¨ `dataStore` å˜æ›´æ—¶åˆ·æ–°ï¼›
  * å¯¹ `getAllFields(items)` ç»“æžœåš memoï¼›
  * datalist åªåœ¨éœ€è¦æ—¶é‡å»ºã€‚
* **å‘¨æœŸä»»åŠ¡æ—¥æœŸé”®æ‰©å±•**ï¼šç›®å‰æ”¯æŒ ðŸ“…/â³/ðŸ›«ã€‚è‹¥éœ€è¦æ›´å¤šæ—¥æœŸé”®ï¼Œå¯åœ¨ `mark.ts` çš„ `replaceIf()` é‡Œæ‰©å±•ã€‚
* **moment ä¾èµ–**ï¼šä»é€šè¿‡ `window.moment`ã€‚è‹¥è¿ç§»è‡³ dayjsï¼Œé›†ä¸­ä¿®æ”¹ `mark.ts` ä¸Ž `utils/date.ts`ã€‚
* **`DataStore.instance['app']`**ï¼šä¸ºä¿æŒå…¼å®¹ï¼Œæœ¬æ¬¡æœªæ”¹åŠ¨ã€‚å»ºè®®åŽç»­æä¾› `getApp()` æˆ–ä¾èµ–æ³¨å…¥ï¼ŒåŽ»é™¤ç´¢å¼•è®¿é—®ã€‚

---

## 8. å»ºè®®çš„æäº¤é¡ºåºï¼ˆCommitsï¼‰

1. **feat(mark): add unified markTaskDone & recurrence helpers**
2. **refactor(store): use markTaskDone in markItemDone**
3. **feat(views): add TaskCheckbox and unify checkbox behavior**
4. **refactor(block/table): use TaskCheckbox, remove duplicates**
5. **feat(date): add getDateRange and use in Dashboard**
6. **chore(settings): use OPS constant; light refresh**
7. **docs: add refactor H1â€“H5 changelog**
